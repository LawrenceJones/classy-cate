#!/usr/bin/env coffee
# vi: set filetype=coffee

fs = require 'fs'
read = require 'read'
msgFile = process.argv[2]

spawnVim = (file, cb) ->
  vim = (require 'child_process').spawn('vim', [file], customFds: [0,1,2])
  vim.on 'exit', cb

(readAndTest = ->
  msg = fs.readFileSync msgFile, 'utf8'
  if not /#\d+/.test msg.replace(/^#.*$/gm, '')
    console.error 'Error! Must reference git issue!'
    read prompt: 'Try again? [y/n]: ', (err, str) ->
      if /y/i.test str
        spawnVim msgFile, readAndTest
      else process.exit -1)()



  
    
